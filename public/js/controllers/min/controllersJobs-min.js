var angular=angular,app=angular.module("myApp.controllersJobs",[]);app.controller("LiveJobCtrl",["$scope","$rootScope","$routeParams","$location","LiveJobsFactory","ShowStats",function(e,a,l,o,t,n){var i=new Date;a.todaysDate=i.toDateString(),e.loading=!0,e.monthOptions=[{label:"Month",value:"0"},{label:"Jan",value:"1"},{label:"Feb",value:"2"},{label:"Mar",value:"3"},{label:"Apr",value:"4"},{label:"May",value:"5"},{label:"Jun",value:"6"},{label:"Jul",value:"7"},{label:"Aug",value:"8"},{label:"Sep",value:"9"},{label:"Oct",value:"10"},{label:"Nov",value:"11"},{label:"Dec",value:"12"}],e.yearOptions=[{label:"Year",value:"0"},{label:"2007",value:"2007"},{label:"2008",value:"2008"},{label:"2009",value:"2009"},{label:"2010",value:"2010"},{label:"2011",value:"2011"},{label:"2012",value:"2012"},{label:"2013",value:"2013"},{label:"2014",value:"2014"},{label:"2015",value:"2015"},{label:"2016",value:"2016"}],e.job={},e.job.months=(new Date).getMonth()+1,e.job.years=(new Date).getFullYear(),n.get({month:e.job.months,year:e.job.years}).$promise.then(function(a){e.liveJobs=a.liveJobs,e.totalTime=a.totalTime,e.totalRevenue=a.totalRevenue,e.loading=!1,e.numLiveJobs=e.liveJobs.length,""===a?e.message="No Live Jobs":e.message=""}),e.selectDate=function(a){var l=a.split("/");e.month=l[0],e.year=l[1],n.get({month:e.month,year:e.year}).$promise.then(function(a){e.liveJobs=a.liveJobs,e.totalTime=a.totalTime,e.totalRevenue=a.totalRevenue,e.graphData=a.graphData,e.graphMonth=a.graphMonth,e.loading=!1,e.numLiveJobs=e.liveJobs.length,""===a?e.message="No Live Jobs":e.message="";var l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.myMonth=l[e.graphMonth-1],e.chartObject={},e.chartObject.data=e.graphData;var o="#E1295F";e.chartObject.type="ColumnChart",e.chartObject.options={title:e.myMonth+" - Yearly History",width:"100%",pointSize:10,colors:[o],fontSize:16,fontName:"Raleway",color:"#333",lineWidth:1,gridlineColor:"#DDD",baselineColor:"#DDD",backgroundColor:{fill:"none"},viewWindowMode:"pretty",pieHole:.4,curveType:"function",chartArea:{left:80,top:100,width:"75%"},titleTextStyle:{fontSize:24,color:"#333333"},legend:{textStyle:{color:"#333333"}},vAxis:{textStyle:{color:"#BBB"}},hAxis:{textStyle:{color:"#BBB"}}}})}}]),app.controller("JobListCtrl",["$scope","$routeParams","JobsFactory","ClientFactory","GraphsFactory","$location",function(e,a,l,o,t,n){e.loading=!0,e.client=o.show({id:a.id}),e.jobs=l.show({id:a.id}),e.jobs.$promise.then(function(l){e.jobs=l,e.job.id=a.id,e.loading=!1}),e.hourOptions=[{label:"Hours",value:"0.00"},{label:"1.00",value:"1.00"},{label:"2.00",value:"2.00"},{label:"3.00",value:"3.00"},{label:"4.00",value:"4.00"},{label:"5.00",value:"5.00"},{label:"6.00",value:"6.00"},{label:"7.00",value:"7.00"},{label:"8.00",value:"8.00"}],e.minuteOptions=[{label:"Minutes",value:"0.00"},{label:"0.25",value:"0.25"},{label:"0.50",value:"0.50"},{label:"0.75",value:"0.75"}],e.job={},e.job.hours=e.hourOptions[0].value,e.job.minutes=e.minuteOptions[0].value,e.addNums=function(a,l){return e.result=a-=-l,e.result},e.status=function(a){return"1"===a?e.closed="closed":e.closed="open",e.closed},e.editJob=function(e){n.path("/jobs-detail/"+e+"/edit/"+a.id)},e.deleteJob=function(a){var o=a.id;e.loading=!0,l["delete"]({id:o}).$promise.then(function(){var l=e.jobs.indexOf(a);e.jobs.splice(l,1),e.loading=!1})},e.createNewJob=function(){e.loading=!0,e.date=new Date,l.create(e.job).$promise.then(function(a){e.jobs.unshift({id:a.insertId,date:e.date,jobdescription:e.job.jobdescription,hours:e.job.hours,minutes:e.job.minutes,misc_costs:e.job.misc_costs}),e.loading=!1,e.jobForm.$setPristine(),e.job.jobdescription="",e.job.hours=e.hourOptions[0].value,e.job.minutes=e.minuteOptions[0].value})},e.showGraph=function(l,o,n){e.loading=!0,e.clientId=l?l:a.id,e.theYear=o?o:2014,e.chartType=n?n:"LineChart",t.show({id:e.clientId,year:e.theYear}).$promise.then(function(a){e.data=a,e.errorMessage=!1,e.performance=[],e.charge_rate=e.data.time[0].charge_rate,e.graphData=a.graphData;for(var l=12,o=0;l-1>=o;o++)e.performance[o]=parseFloat(e.data.totalTime[o]);e.loading=!1,e.chartObject={},e.chartObject.data=e.graphData;var t="#E1295F";e.chartObject.type=e.chartType,e.chartObject.options={title:"Year: "+e.data.year,width:"100%",pointSize:10,colors:[t],fontSize:16,fontName:"Raleway",color:"#333",lineWidth:1,gridlineColor:"#DDD",baselineColor:"#DDD",backgroundColor:{fill:"none"},viewWindowMode:"pretty",pieHole:.4,curveType:"function",chartArea:{left:80,top:100,width:"75%"},titleTextStyle:{fontSize:24,color:"#333333"},legend:{textStyle:{color:"#333333"}},vAxis:{textStyle:{color:"#BBB"}},hAxis:{textStyle:{color:"#BBB"}}}},function(a){e.error=a,e.loading=!1,e.errorMessage="big fat nothing!"})}}]),app.controller("JobsDetailCtrl",["$scope","$routeParams","JobFactory","JobsFactory","$location",function(e,a,l,o,t){e.jobs=l.show({id:a.id}),e.jobs.$promise.then(function(a){e.jobs=a}),e.updateJob=function(){e.loading=!0,o.update(e.jobs).$promise.then(function(){e.jobs=o.show({id:a.id}),t.path("/jobs-list/"+a.item),e.loading=!1})},e.cancel=function(){t.path("/jobs-list/"+a.item)},e.hourOptions=[{label:"Hours",value:"0.00"},{label:"1.00",value:"1.00"},{label:"2.00",value:"2.00"},{label:"3.00",value:"3.00"},{label:"4.00",value:"4.00"},{label:"5.00",value:"5.00"},{label:"6.00",value:"6.00"},{label:"7.00",value:"7.00"},{label:"8.00",value:"8.00"}],e.minuteOptions=[{label:"Minutes",value:"0.00"},{label:"0.25",value:"0.25"},{label:"0.50",value:"0.50"},{label:"0.75",value:"0.75"}],e.jobStatusOptions=[{label:"Open",value:"0"},{label:"Closed",value:"1"}]}]);